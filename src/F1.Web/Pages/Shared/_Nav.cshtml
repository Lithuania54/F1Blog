@using Microsoft.AspNetCore.Identity
@using F1.Web.Models
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@inject IHttpContextAccessor HttpContextAccessor

@{
    var path = HttpContextAccessor?.HttpContext?.Request?.Path.Value?.TrimEnd('/')?.ToLowerInvariant() ?? "/";
    bool IsActivePrefix(string p) => path.StartsWith(p.TrimEnd('/').ToLowerInvariant());
    var userInitial = User?.Identity?.Name?.FirstOrDefault();
}

<header class="g-nav" role="banner">
  <div class="g-nav__inner">
    <div class="g-nav__brand">
      <a asp-page="/Index" class="g-logo">F1 Garage</a>
    </div>

    <input type="checkbox" id="nav-toggle" class="g-nav__toggle" aria-label="Toggle navigation" />
    <label for="nav-toggle" class="g-nav__burger" aria-controls="mainNav" aria-expanded="false">
      <span></span><span></span><span></span>
    </label>

    <nav id="mainNav" class="g-nav__links" aria-label="Main navigation">
      <a class="g-nav__link @(IsActivePrefix("/races") ? "is-active" : "")" asp-page="/Races/Index">Race Weekends</a>
      <a class="g-nav__link @(IsActivePrefix("/races/details") ? "is-active" : "")" asp-page="/Races/Details">Weekend Detail</a>
      <a class="g-nav__link @(IsActivePrefix("/standings") ? "is-active" : "")" asp-page="/Standings/Index">Standings</a>
      <a class="g-nav__link @(IsActivePrefix("/game") ? "is-active" : "")" asp-page="/Game/Index">Game</a>
      <a class="g-nav__link @(IsActivePrefix("/blogs") ? "is-active" : "")" asp-page="/Blogs/Index">Blog</a>
      <a class="g-nav__link @(IsActivePrefix("/predictions") ? "is-active" : "")" asp-page="/Predictions/Leaderboard">Predictions</a>
    </nav>

    <div class="g-nav__actions">
      @if (SignInManager.IsSignedIn(User))
      {
          <a class="g-btn g-btn-accent" asp-page="/Blogs/Create">Write a blog</a>
          <div class="g-avatar">@((userInitial.HasValue && !char.IsControl(userInitial.Value)) ? userInitial.Value.ToString().ToUpper() : "F")</div>
          <form asp-area="Identity" asp-page="/Account/Logout" method="post" class="d-inline">
            <button type="submit" class="g-btn g-btn-ghost">Logout</button>
          </form>
      }
      else
      {
          <a class="g-link-muted @(IsActivePrefix("/auth/login") ? "is-active" : "")" asp-page="/Auth/Login">Log in</a>
          <a class="g-btn g-btn-accent" asp-page="/Auth/Register">Create account</a>
      }
    </div>
  </div>
</header>
