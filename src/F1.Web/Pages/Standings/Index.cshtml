@page
@model F1.Web.Pages.Standings.IndexModel
@using System.Linq
@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
    ViewData["Title"] = "Standings";
}

<section class="g-container g-section">
  <div class="g-hero__shell g-hero__shell--compact">
    <div class="g-hero__copy">
      <div class="g-hero__eyebrow">Leaderboards</div>
      <h1 class="g-hero__title">Who's leading the fight in 2025</h1>
    </div>
    <div class="g-panel">
      <div class="g-card__title mb-1">Next race</div>
      <div class="g-card__muted">@Model.NextRace.Name (@Model.NextRace.Country)</div>
      <div class="g-tag">@Model.NextRace.LocalStartDisplay</div>
      <div class="g-countdown" data-start="@Model.NextRace.StartTimeUtc.ToUniversalTime().ToString("o")">
        <span class="g-count g-days">--</span>d
        <span class="g-count g-hours">--</span>h
        <span class="g-count g-mins">--</span>m
      </div>
    </div>
  </div>

  <div class="lb-wrap">
    <div class="lb-group">
      <div class="lb-header">
        <h2>Drivers</h2>
      </div>
      <div class="lb-top3">
        @foreach (var d in Model.DriverStandings.Take(3))
        {
          <article class="lb-card">
            <div class="lb-card__body">
              <div class="lb-img" style="background-image:url('@d.ImageUrl');"></div>
              <div>
                <div class="lb-name">@d.Name</div>
                <div class="lb-meta">@d.Team</div>
                <div class="lb-points">@d.Points pts</div>
              </div>
            </div>
          </article>
        }
      </div>
      <div class="table-responsive">
        <table class="g-table">
          <thead>
            <tr>
              <th scope="col">Pos</th>
              <th scope="col">Driver</th>
              <th scope="col">Team</th>
              <th scope="col">Points</th>
            </tr>
          </thead>
          <tbody>
            @foreach(var d in Model.DriverStandings)
            {
              <tr>
                <td>@d.Position</td>
                <td>@d.Name</td>
                <td>@d.Team</td>
                <td>@d.Points</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

    <div class="lb-group">
      <div class="lb-header">
        <h2>Teams</h2>
      </div>
      <div class="lb-top3">
        @foreach (var entry in Model.TeamStandings.Take(3).Select((team, idx) => new { team, idx }))
        {
          var podiumClass = entry.idx == 0 ? "podium-first" : entry.idx == 1 ? "podium-second" : "podium-third";
          <article class="lb-card lb-card--podium @podiumClass">
            <div class="lb-chip lb-chip--podium">#@(entry.idx + 1)</div>
            <div class="lb-card__body">
              <div class="lb-img lb-img--team lb-img--podium" style="background-image:url('@entry.team.ImageUrl');"></div>
              <div>
                <div class="lb-name">@entry.team.Name</div>
                <div class="lb-meta">Constructor</div>
                <div class="lb-points">@entry.team.Points pts</div>
              </div>
            </div>
          </article>
        }
      </div>
      <div class="table-responsive">
        <table class="g-table">
          <thead>
            <tr>
              <th scope="col">Pos</th>
              <th scope="col">Team</th>
              <th scope="col">Points</th>
            </tr>
          </thead>
          <tbody>
            @foreach(var t in Model.TeamStandings)
            {
              <tr>
                <td>@t.Position</td>
                <td>@t.Name</td>
                <td>@t.Points</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

@section Scripts {
  <script>
    (function(){
      const el = document.querySelector('.g-countdown');
      if(!el) return;
      const start = new Date(el.dataset.start);
      const daysEl = el.querySelector('.g-days');
      const hoursEl = el.querySelector('.g-hours');
      const minsEl = el.querySelector('.g-mins');
      const tick = () => {
        const now = new Date();
        let diff = Math.max(0, start - now);
        const days = Math.floor(diff / (1000*60*60*24));
        diff -= days*1000*60*60*24;
        const hours = Math.floor(diff / (1000*60*60));
        diff -= hours*1000*60*60;
        const mins = Math.floor(diff / (1000*60));
        daysEl.textContent = days.toString().padStart(2,'0');
        hoursEl.textContent = hours.toString().padStart(2,'0');
        minsEl.textContent = mins.toString().padStart(2,'0');
      };
      tick(); setInterval(tick, 60000);
    })();
  </script>
}
