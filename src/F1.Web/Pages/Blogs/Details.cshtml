@page "{id:int}"
@model F1.Web.Pages.Blogs.DetailsModel
@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
    ViewData["Title"] = Model.Post?.Title ?? "Post";
    var createdAt = Model.Post?.CreatedAt.ToLocalTime().ToString("yyyy-MM-dd HH:mm") ?? "--";
}

<section class="g-container g-section">
  <article class="g-card g-article-card">
    <div class="g-hero__eyebrow">Blog</div>
    <h1 class="g-article__title">@Model.Post?.Title</h1>

    <div class="blog-card__meta">
      <span>Posted: @createdAt</span>
      @if (!string.IsNullOrEmpty(Model.Post?.AuthorName)) { <span class="blog-card__separator">-</span><span>@Model.Post.AuthorName</span> }
    </div>

    @if (!string.IsNullOrEmpty(Model.Post?.ImageUrl))
    {
        <div class="g-article__image">
          <img src="@Model.Post.ImageUrl" alt="cover" />
        </div>
    }

    @if (!string.IsNullOrEmpty(Model.Post?.Hashtags))
    {
        var tags = Model.Post.Hashtags.Split(',', StringSplitOptions.RemoveEmptyEntries | StringSplitOptions.TrimEntries);
        <div class="g-article__tags">
            @foreach (var t in tags) { <span class="badge bg-secondary me-1">#@t</span> }
        </div>
    }

    <div class="g-article">
      @* Simple rendering of plain/markdown text. If you want Markdown rendering, use Markdig to convert to HTML safely. *@
      @foreach (var line in (Model.Post?.Content ?? "").Split(new[] { "\n\n" }, StringSplitOptions.None))
      {
          <p>@line</p>
      }
    </div>

    @{
      var hasNoOwner = string.IsNullOrWhiteSpace(Model.Post?.CreatedByUserName);
      var isOwner = User?.Identity?.IsAuthenticated == true && string.Equals(User.Identity?.Name, Model.Post?.CreatedByUserName, StringComparison.Ordinal);
    }
    @if (User?.Identity?.IsAuthenticated == true && (User.IsInRole("Admin") || hasNoOwner || isOwner))
    {
      <div class="g-article__actions">
        <a asp-page="/Blogs/Edit" asp-route-id="@Model.Post?.Id" class="g-btn g-btn-secondary g-btn-sm">Edit</a>
        <a asp-page="/Blogs/Delete" asp-route-id="@Model.Post?.Id" class="g-btn g-btn-danger g-btn-sm">Delete</a>
      </div>
    }
  </article>
</section>
