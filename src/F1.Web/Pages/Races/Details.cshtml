@page
@model F1.Web.Pages.Races.DetailsModel
@{
    Layout = "~/Pages/Shared/_Layout.cshtml";
    ViewData["Title"] = "Race Weekend";
}

<section class="g-container g-section">
  <div class="g-hero__shell g-hero__shell--compact">
    <div class="g-hero__copy">
      <div class="g-hero__eyebrow">Race Weekend</div>
      <h1 class="g-hero__title">@Model.Race.Name</h1>
      <p class="g-hero__text">@Model.Race.Country â€¢ @Model.Race.Circuit</p>
      <div class="g-tag">Local start: @Model.Race.LocalStartDisplay</div>
      <div class="g-countdown" data-start="@Model.Race.StartTimeUtc.ToUniversalTime().ToString("o")">
        <span class="g-count g-days">--</span>d
        <span class="g-count g-hours">--</span>h
        <span class="g-count g-mins">--</span>m
      </div>
    </div>
    <div class="g-panel">
      <div class="g-card__title">Weather</div>
      <div class="g-card__muted">@Model.WeatherSummary</div>
      <div class="g-card__muted">@Model.Temperature</div>
    </div>
  </div>

  <div class="g-grid g-grid-cols-3">
    <div class="g-card">
      <div class="g-card__title">Session times (local)</div>
      <ul class="list-unstyled g-card__muted mb-0">
        @foreach (var s in Model.Sessions)
        {
          <li>@s.Name: @s.TimeLocal</li>
        }
      </ul>
    </div>
    <div class="g-card">
      <div class="g-card__title">Tyre allocation</div>
      <div class="g-card__muted">@Model.TyreAllocation</div>
    </div>
    <div class="g-card">
      <div class="g-card__title">Track map</div>
      @if (!string.IsNullOrWhiteSpace(Model.Race.TrackMapUrl))
      {
        <img src="@Model.Race.TrackMapUrl" alt="Track map" style="width:100%;object-fit:contain;border-radius:12px;border:1px solid var(--border);" />
      }
      else
      {
        <div class="g-card__muted">No map available.</div>
      }
    </div>
  </div>
</section>

@section Scripts {
  <script>
    (function(){
      const el = document.querySelector('.g-countdown');
      if(!el) return;
      const start = new Date(el.dataset.start);
      const d=el.querySelector('.g-days'),h=el.querySelector('.g-hours'),m=el.querySelector('.g-mins');
      const tick=()=>{const now=new Date();let diff=Math.max(0,start-now);const days=Math.floor(diff/86400000);diff-=days*86400000;const hours=Math.floor(diff/3600000);diff-=hours*3600000;const mins=Math.floor(diff/60000);d.textContent=days.toString().padStart(2,'0');h.textContent=hours.toString().padStart(2,'0');m.textContent=mins.toString().padStart(2,'0');};
      tick(); setInterval(tick,60000);
    })();
  </script>
}
